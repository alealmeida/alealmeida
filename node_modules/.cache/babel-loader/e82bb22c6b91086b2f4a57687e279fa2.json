{"ast":null,"code":"import _slicedToArray from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/src/lib/components/Fullpage.js\";\nimport React from 'react';\nimport ScrollSwipe from 'scroll-swipe';\nimport root from 'window-or-global';\nimport { WindowSize } from 'react-fns';\nimport { detectBrowser, constants, scrollTo, renderUtils, INTENT_MAP, getNodes, showAll, hideAllButActive, composedPath } from '../utils';\nimport Slide from './Slide';\nimport HorizontalSlider from './HorizontalSlider';\nvar noOp = constants.noOp;\nvar KEY_IDX = renderUtils.KEY_IDX;\nvar _fp = {};\nvar global = {};\nvar TIMEOUT = 200;\n\nvar documentStub = function documentStub() {\n  var style = {};\n  return {\n    querySelectorAll: function querySelectorAll() {\n      return [React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 21\n        },\n        __self: this\n      })];\n    },\n    documentElement: {\n      style: style\n    },\n    body: {\n      style: style\n    }\n  };\n};\n\nfunction generateState() {\n  var activeSlide = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return {\n    activeSlide: activeSlide,\n    lastActive: activeSlide - 1\n  };\n}\n\nvar Fullpage =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Fullpage, _React$Component);\n\n  function Fullpage(props) {\n    var _this;\n\n    _classCallCheck(this, Fullpage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Fullpage).call(this, props));\n    var p = _this.props;\n    global.window = root;\n    global.document = global.window.document || documentStub();\n\n    if (p.infinite && p.resetSlides) {\n      throw new Error('Fullpage Component cannot have both infinite and resetSlides as truthy props');\n    }\n\n    var slides = p.slides;\n\n    if (!slides || !slides.length) {\n      throw new Error('Please provide slides for Fullpage');\n    }\n\n    var horizontalMap = {}; // generate state for horizontals;\n\n    var horizontals = slides.reduce(function (result, s, i) {\n      var name = s.props.name;\n\n      if (s.props.slides && name) {\n        result[name] = generateState(0);\n        horizontalMap[i] = name;\n      }\n\n      return result;\n    }, {});\n    horizontals.horizontalMap = horizontalMap;\n    var _p$activeSlide = p.activeSlide,\n        activeSlide = _p$activeSlide === void 0 ? 0 : _p$activeSlide,\n        scrollSensitivity = p.scrollSensitivity,\n        touchSensitivity = p.touchSensitivity,\n        _p$scrollSpeed = p.scrollSpeed,\n        scrollSpeed = _p$scrollSpeed === void 0 ? 500 : _p$scrollSpeed;\n    _this.name = 'Fullpage';\n    _this.scrollSensitivity = scrollSensitivity;\n    _this.touchSensitivity = touchSensitivity;\n    _this.scrollSpeed = scrollSpeed;\n    _this.node = null;\n    _this.ss = null;\n    _this.verticalRoot = determineVerticalRoot();\n    _this.onHorizontalChange = p.onHorizontalChange || noOp;\n    _this.onSlideChangeStart = p.onSlideChangeStart || noOp;\n    _this.onSlideChangeEnd = p.onSlideChangeEnd || noOp;\n    ['onScrollAction', 'onVerticalScroll', 'onHorizontalScroll', 'lockScroll', 'handleScroll', 'checkKey'].forEach(function (f) {\n      return _this[f] = _this[f].bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    });\n    _this.isLocked = false;\n    _this.hSlideCache = {};\n\n    _this.cacheHslide = function (slide) {\n      _this.hSlideCache[slide.name] = slide;\n    };\n\n    _fp = _assertThisInitialized(_assertThisInitialized(_this));\n    _this.state = Object.assign({\n      scrollPending: false,\n      window: null,\n      document: null\n    }, horizontals, generateState(activeSlide));\n    return _this;\n  }\n\n  _createClass(Fullpage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.hideScrollBars();\n      this.window = global.window;\n      this.document = global.document;\n      this.setState({\n        window: global.window,\n        document: global.document\n      }, function () {\n        _this2.lockScroll();\n      });\n    }\n  }, {\n    key: \"hideScrollBars\",\n    value: function hideScrollBars() {\n      var hideScrollBars = this.props.hideScrollBars;\n\n      if (!hideScrollBars) {\n        return;\n      }\n\n      var document = global.document;\n      document.documentElement.style.overflow = 'hidden';\n      document.body.style.overflow = 'hidden';\n    }\n  }, {\n    key: \"showScrollBars\",\n    value: function showScrollBars() {\n      var document = global.document;\n      document.documentElement.style.overflow = 'auto';\n      document.body.style.overflow = 'auto';\n    }\n  }, {\n    key: \"lockScroll\",\n    value: function lockScroll() {\n      var node = this.node,\n          checkKey = this.checkKey;\n      var enableArrowKeys = this.props.enableArrowKeys;\n\n      if (enableArrowKeys) {\n        window.addEventListener('keydown', checkKey.bind(this));\n      }\n\n      var ss = new ScrollSwipe({\n        target: node,\n        scrollSensitivity: this.scrollSensitivity,\n        touchSensitivity: this.touchSensitivity,\n        scrollPreventDefault: true,\n        touchPreventDefault: true,\n        scrollCb: this.onScrollAction,\n        touchCb: this.onScrollAction\n      });\n      this.ss = ss;\n      this.isLocked = true;\n    }\n  }, {\n    key: \"onScrollAction\",\n    value: function onScrollAction(_ref) {\n      var direction = _ref.direction,\n          intent = _ref.intent,\n          startEvent = _ref.startEvent;\n      var s = this.state;\n      var _this$ss = this.ss,\n          ss = _this$ss === void 0 ? ssStub() : _this$ss;\n\n      if (s.scrollPending) {\n        ss.flush();\n        return ss.listen();\n      }\n\n      var dir = INTENT_MAP[direction]; // at this point we are dedicating\n\n      if (direction === 'VERTICAL') {\n        return this.onVerticalScroll(dir[intent], startEvent);\n      }\n\n      var path = startEvent.path || startEvent.composedPath && startEvent.composedPath();\n\n      if (!path) {\n        var polyFillPath = composedPath(startEvent.target);\n        path = polyFillPath;\n      }\n\n      var isHorizontal = path.find(function (p) {\n        if (!p.dataset) {\n          return false;\n        }\n\n        return p.dataset.slide === 'HorizontalSlider';\n      });\n\n      if (!isHorizontal) {\n        ss.flush();\n        return ss.listen();\n      }\n\n      this.onHorizontalScroll(dir[intent], isHorizontal);\n    }\n  }, {\n    key: \"onVerticalScroll\",\n    value: function onVerticalScroll(intent) {\n      var _this3 = this;\n\n      var s = this.state;\n      var window = s.window,\n          activeSlide = s.activeSlide;\n      var slides = this.props.slides;\n      var next = intent === 'DOWN' ? activeSlide + 1 : activeSlide - 1;\n\n      if (next < 0 || next > slides.length - 1) {\n        var _this$ss2 = this.ss,\n            ss = _this$ss2 === void 0 ? ssStub() : _this$ss2;\n        ss.flush();\n        return ss.listen();\n      }\n\n      var to = next * window.innerHeight;\n      var newState = {\n        activeSlide: next,\n        lastActive: activeSlide\n      };\n      this.setState({\n        scrollPending: true\n      }, function () {\n        _this3.handleScroll(_this3.verticalRoot, 'scrollTop', to, newState, _this3.name);\n      });\n    }\n  }, {\n    key: \"onHorizontalScroll\",\n    value: function onHorizontalScroll(intent, node) {\n      var name = node.dataset.name;\n      var activeSlide = this.state[name].activeSlide;\n      var next = intent === 'RIGHT' ? activeSlide + 1 : activeSlide - 1;\n      var innerWidth = this.state.window.innerWidth;\n      var _this$ss3 = this.ss,\n          ss = _this$ss3 === void 0 ? ssStub() : _this$ss3;\n      var comp = _fp.hSlideCache[name];\n      var hp = comp.props;\n      var infinite = hp.infinite;\n      var nodes = getNodes(this.state.document, \"data-horizontal-slider=\\\"\".concat(name, \"\\\"\"));\n      var leftVal = activeSlide * innerWidth;\n      var to = next * innerWidth;\n      var result = this.determineHSlide(comp, activeSlide, next, leftVal, to, nodes);\n\n      if (!result) {\n        setTimeout(function () {\n          ss.flush();\n          ss.listen();\n        }, TIMEOUT);\n        return;\n      }\n\n      leftVal = result.leftVal;\n      next = result.next;\n      to = result.to;\n\n      var newState = _defineProperty({}, name, {\n        activeSlide: next,\n        lastActive: activeSlide\n      });\n\n      this.handleHorizontal(name, node, nodes, leftVal, to, next, newState, infinite);\n    }\n  }, {\n    key: \"determineHSlide\",\n    value: function determineHSlide(comp, activeSlide, next, leftVal, to, nodes) {\n      var hp = comp.props;\n      var infinite = hp.infinite,\n          resetSlides = hp.resetSlides;\n      var innerWidth = this.state.window.innerWidth;\n      var len = nodes.length;\n      var infStart = activeSlide === 0 && next === -1;\n      var infEnd = activeSlide === len - 1 && next === len;\n\n      if (!infinite && !resetSlides && (infStart || infEnd)) {\n        return null;\n      }\n\n      if (infinite && infStart) {\n        // simulate last <- 0\n        next = len - 1;\n        lastToFirst(nodes);\n        leftVal = innerWidth;\n        to = 0;\n      } else if (infinite && infEnd) {\n        // simulate last -> 0\n        next = 0;\n        lastToFirst(nodes);\n        leftVal = 0;\n        to = innerWidth;\n      }\n\n      var result = {\n        next: next,\n        leftVal: leftVal,\n        to: to\n      };\n      return result;\n    }\n  }, {\n    key: \"handleHorizontal\",\n    value: function handleHorizontal(name, node, nodes, leftVal, to, next, newState, infinite) {\n      var _this4 = this;\n\n      showAll(nodes);\n      node.scrollLeft = leftVal; //show, reset window\n      //scroll\n      //hide\n\n      this.setState({\n        scrollPending: true\n      }, function () {\n        _this4.handleScroll(node, 'scrollLeft', to, newState, name, function () {\n          if (infinite) {\n            firstToLast(nodes);\n            node.scrollLeft = innerWidth * next;\n          }\n\n          hideAllButActive(next, nodes);\n        });\n      });\n    }\n  }, {\n    key: \"handleScroll\",\n    value: function handleScroll(node, winProp, to, newState, compName) {\n      var _this5 = this;\n\n      var cb = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : noOp;\n      var ss = this.ss || ssStub();\n      ss.flush();\n      var cancellable = this.onSlideChangeStart(compName, this.props, this.state, newState[compName] || newState);\n\n      if (cancellable === true) {\n        return;\n      }\n\n      scrollTo(node, winProp, to, this.scrollSpeed, function () {\n        newState.scrollPending = false;\n\n        _this5.setState(newState, function () {\n          cb();\n\n          _this5.onSlideChangeEnd(compName, _this5.props, _this5.state, newState[compName] || newState);\n\n          setTimeout(function () {\n            ss.flush();\n            ss.listen();\n          }, TIMEOUT);\n        });\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      var ss = this.ss || ssStub();\n      ss.killAll();\n      this.ss = null;\n      var window = this.state.window;\n\n      if (this.props.enableArrowKeys) {\n        window.removeEventListener('keydown', this.checkKey);\n      }\n\n      if (this.props.hideScrollBars) {\n        this.showScrollBars();\n      }\n    }\n  }, {\n    key: \"checkKey\",\n    value: function checkKey(e) {\n      var direction = KEY_IDX[e.keyCode];\n\n      if (!direction) {\n        return;\n      }\n\n      var intent = direction === 'UP' || direction === 'LEFT' ? -1 : 1;\n      var context = direction === 'UP' || direction === 'DOWN' ? 'VERTICAL' : 'HORIZONTAL';\n\n      if (context === 'VERTICAL') {\n        Fullpage.changeFullpageSlide(this.state.activeSlide + intent);\n        return;\n      }\n\n      var horizontalName = this.state.horizontalMap[this.state.activeSlide];\n\n      if (!horizontalName) {\n        return;\n      }\n\n      var activeSlide = this.state[horizontalName].activeSlide;\n      Fullpage.changeHorizontalSlide(horizontalName, activeSlide + intent);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var s = this.state;\n      var p = this.props;\n      var window = s.window,\n          document = s.document,\n          activeSlide = s.activeSlide;\n      var children = p.children || null;\n\n      if (!window) {\n        return children;\n      }\n\n      var elements = p.slides.reduce(function (result, sl) {\n        if (!sl) {\n          return result;\n        }\n\n        if (typeof sl.type !== 'function') {\n          result.other.push(sl);\n        } else {\n          result.slides.push(sl);\n        }\n\n        return result;\n      }, {\n        slides: [],\n        other: []\n      });\n      var other = elements.other,\n          slides = elements.slides; // TODO: sub other for children\n\n      return React.createElement(WindowSize, {\n        render: function render(_ref2) {\n          var width = _ref2.width,\n              height = _ref2.height;\n          var to = activeSlide * height;\n          setTimeout(function () {\n            _this6.verticalRoot.scrollTop = to;\n          }, 0);\n          return React.createElement(\"div\", {\n            ref: function ref(node) {\n              return _this6.node = node;\n            },\n            className: \"Fullpage\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 471\n            },\n            __self: this\n          }, children, other.map(function (o, i) {\n            var op = o.props || {};\n            return React.createElement(\"div\", Object.assign({\n              key: i\n            }, op, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 475\n              },\n              __self: this\n            }));\n          }), slides.map(function (sl, i) {\n            var sp = sl.props || {};\n            var children = sp.children;\n\n            if (sp.slides) {\n              var name = sp.name;\n              return React.createElement(HorizontalSlider, Object.assign({\n                cache: _this6.cacheHslide.bind(_this6),\n                width: width,\n                height: height,\n                window: window,\n                document: document,\n                activeSlide: s[name].activeSlide,\n                hideScrollBars: p.hideScrollBars\n              }, sp, {\n                key: i,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 484\n                },\n                __self: this\n              }), children);\n            }\n\n            return React.createElement(Slide, Object.assign({\n              render: true,\n              className: sp.className || '',\n              id: sp.id,\n              width: width,\n              height: height,\n              key: i\n            }, sp, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 489\n              },\n              __self: this\n            }), children);\n          }));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 462\n        },\n        __self: this\n      });\n    }\n  }], [{\n    key: \"changeHorizontalSlide\",\n    value: function changeHorizontalSlide(name, next) {\n      next = +next;\n      var comp = _fp.hSlideCache[name];\n\n      if (!comp) {\n        throw Error('cannt find HorizontalSlider by name', name);\n      }\n\n      var node = comp.node,\n          props = comp.props;\n      var infinite = props.infinite;\n      var eligible = isEligible(next, props, _fp.state);\n\n      if (!eligible) {\n        return;\n      }\n\n      var activeSlide = _fp.state[name].activeSlide;\n      var innerWidth = _fp.state.window.innerWidth;\n      var nodes = getNodes(_fp.state.document, \"data-horizontal-slider=\\\"\".concat(name, \"\\\"\"));\n      var leftVal = activeSlide * innerWidth;\n      var to = next * innerWidth;\n\n      var result = _fp.determineHSlide.call(_fp, comp, activeSlide, next, leftVal, to, nodes);\n\n      leftVal = result.leftVal;\n      next = result.next;\n      to = result.to;\n\n      var newState = _defineProperty({}, name, {\n        activeSlide: next,\n        lastActive: activeSlide\n      });\n\n      _fp.handleHorizontal.call(_fp, name, node, nodes, leftVal, to, next, newState, infinite);\n    }\n  }, {\n    key: \"changeFullpageSlide\",\n    value: function changeFullpageSlide(idx) {\n      var _fp2 = _fp,\n          props = _fp2.props,\n          state = _fp2.state,\n          name = _fp2.name,\n          verticalRoot = _fp2.verticalRoot;\n      var activeSlide = state.activeSlide,\n          window = state.window;\n      var eligible = isEligible(idx, props, state);\n\n      if (!eligible) {\n        return;\n      }\n\n      var newState = {\n        activeSlide: idx,\n        lastActive: activeSlide\n      };\n      var to = idx * window.innerHeight;\n\n      _fp.setState({\n        scrollPending: true\n      }, function () {\n        _fp.onSlideChangeStart(name, props, state, newState);\n\n        _fp.handleScroll(verticalRoot, 'scrollTop', to, newState, name);\n      });\n    }\n  }]);\n\n  return Fullpage;\n}(React.Component);\n\nfunction swap(nodes, o, i) {\n  nodes[o || i].parentNode.insertBefore(nodes[i], nodes[o]);\n  return nodes;\n}\n\nfunction lastToFirst(nodes) {\n  swap(nodes, 0, nodes.length - 1);\n}\n\nfunction firstToLast(nodes) {\n  swap(nodes, null, nodes.length - 1);\n}\n\nfunction isEligible(idx, props, state) {\n  var slides = props.slides;\n  var activeSlide = state.activeSlide;\n\n  if (state.scrollPending) {\n    return false;\n  }\n\n  if (props.infinite) {\n    return true;\n  }\n\n  if (idx > slides.length - 1 || idx < 0) {\n    return false;\n  }\n\n  if (idx == activeSlide) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction ssStub() {\n  return {\n    flush: noOp,\n    killAll: noOp,\n    listen: noOp\n  };\n}\n\nfunction determineVerticalRoot() {\n  var userAgent, platform;\n  var document = global.document;\n\n  if (typeof navigator !== 'undefined' && navigator) {\n    var _navigator = navigator;\n    userAgent = _navigator.userAgent;\n    platform = _navigator.platform;\n  }\n\n  if (!userAgent) {\n    return document.body;\n  } // http://developer.samsung.com/technical-doc/view.do?v=T000000203\n\n\n  if (/SAMSUNG.*Build\\//.test(userAgent)) {\n    return document.body;\n  }\n\n  var browser = detectBrowser(userAgent);\n\n  if (!browser) {\n    return document.body;\n  } // NOTE: various browsers and devTools handle this differently as the userAgent source of truth\n  // To get the root scrollable element we have to play around with OS and browser to find the right\n  // root to return. If need be we can be specific about version\n\n\n  var name = browser.name,\n      version = browser.version,\n      os = browser.os; // eslint-disable-line no-unused-vars\n\n  var _version$split = version.split('.'),\n      _version$split2 = _slicedToArray(_version$split, 3),\n      major = _version$split2[0],\n      minor = _version$split2[1],\n      patch = _version$split2[2]; // eslint-disable-line no-unused-vars\n\n\n  var docElementSet = new Set(['firefox', 'chrome', 'ios', // iPad (chrome devtools)\n  'crios', // chrome ios (chrome devtools)\n  'ie']); // Some platforms conflict with the devtools when it comes to supporting document.body\n  // In order to support both user-agents in chrome devtools and the native device we need to\n  // check for both browser name and device platform\n\n  var conflictingPlatforms = new Set(['iPhone', 'iPad']);\n\n  if (docElementSet.has(name) && !conflictingPlatforms.has(platform)) {\n    return document.documentElement;\n  } // safari, chrome ios etc\n\n\n  return document.body;\n}\n\nexport default Fullpage;","map":{"version":3,"sources":["/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/src/lib/components/Fullpage.js"],"names":["React","ScrollSwipe","root","WindowSize","detectBrowser","constants","scrollTo","renderUtils","INTENT_MAP","getNodes","showAll","hideAllButActive","composedPath","Slide","HorizontalSlider","noOp","KEY_IDX","_fp","global","TIMEOUT","documentStub","style","querySelectorAll","documentElement","body","generateState","activeSlide","lastActive","Fullpage","props","p","window","document","infinite","resetSlides","Error","slides","length","horizontalMap","horizontals","reduce","result","s","i","name","scrollSensitivity","touchSensitivity","scrollSpeed","node","ss","verticalRoot","determineVerticalRoot","onHorizontalChange","onSlideChangeStart","onSlideChangeEnd","forEach","f","bind","isLocked","hSlideCache","cacheHslide","slide","state","Object","assign","scrollPending","hideScrollBars","setState","lockScroll","overflow","checkKey","enableArrowKeys","addEventListener","target","scrollPreventDefault","touchPreventDefault","scrollCb","onScrollAction","touchCb","direction","intent","startEvent","ssStub","flush","listen","dir","onVerticalScroll","path","polyFillPath","isHorizontal","find","dataset","onHorizontalScroll","next","to","innerHeight","newState","handleScroll","innerWidth","comp","hp","nodes","leftVal","determineHSlide","setTimeout","handleHorizontal","len","infStart","infEnd","lastToFirst","scrollLeft","firstToLast","winProp","compName","cb","cancellable","killAll","removeEventListener","showScrollBars","e","keyCode","context","changeFullpageSlide","horizontalName","changeHorizontalSlide","children","elements","sl","type","other","push","width","height","scrollTop","map","o","op","sp","className","id","eligible","isEligible","call","idx","Component","swap","parentNode","insertBefore","userAgent","platform","navigator","test","browser","version","os","split","major","minor","patch","docElementSet","Set","conflictingPlatforms","has"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,MAAwB,cAAxB;AACA,OAAOC,IAAP,MAAiB,kBAAjB;AACA,SAASC,UAAT,QAA2B,WAA3B;AAEA,SAASC,aAAT,EAAwBC,SAAxB,EAAmCC,QAAnC,EAA6CC,WAA7C,EAA0DC,UAA1D,EAAsEC,QAAtE,EAAgFC,OAAhF,EAAyFC,gBAAzF,EAA2GC,YAA3G,QAA+H,UAA/H;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;IAEQC,I,GAASV,S,CAATU,I;IACAC,O,GAAYT,W,CAAZS,O;AAER,IAAIC,GAAG,GAAG,EAAV;AACA,IAAIC,MAAM,GAAG,EAAb;AAEA,IAAMC,OAAO,GAAG,GAAhB;;AAEA,IAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB,MAAMC,KAAK,GAAG,EAAd;AACA,SAAO;AACLC,IAAAA,gBAAgB,EAAE;AAAA,aAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAD,CAAN;AAAA,KADb;AAELC,IAAAA,eAAe,EAAE;AACfF,MAAAA,KAAK,EAALA;AADe,KAFZ;AAKLG,IAAAA,IAAI,EAAE;AACJH,MAAAA,KAAK,EAALA;AADI;AALD,GAAP;AASD,CAXD;;AAaA,SAASI,aAAT,GAAwC;AAAA,MAAjBC,WAAiB,uEAAH,CAAG;AACtC,SAAO;AACLA,IAAAA,WAAW,EAAXA,WADK;AAELC,IAAAA,UAAU,EAAED,WAAW,GAAG;AAFrB,GAAP;AAID;;IAEKE,Q;;;;;AACJ,oBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,kFAAMA,KAAN;AACA,QAAMC,CAAC,GAAG,MAAKD,KAAf;AAEAX,IAAAA,MAAM,CAACa,MAAP,GAAgB7B,IAAhB;AACAgB,IAAAA,MAAM,CAACc,QAAP,GAAkBd,MAAM,CAACa,MAAP,CAAcC,QAAd,IAA0BZ,YAAY,EAAxD;;AAEA,QAAIU,CAAC,CAACG,QAAF,IAAcH,CAAC,CAACI,WAApB,EAAiC;AAC/B,YAAM,IAAIC,KAAJ,CAAU,8EAAV,CAAN;AACD;;AATgB,QAWTC,MAXS,GAWEN,CAXF,CAWTM,MAXS;;AAajB,QAAI,CAACA,MAAD,IAAW,CAACA,MAAM,CAACC,MAAvB,EAA+B;AAC7B,YAAM,IAAIF,KAAJ,CAAU,oCAAV,CAAN;AACD;;AAED,QAAIG,aAAa,GAAG,EAApB,CAjBiB,CAkBjB;;AACA,QAAMC,WAAW,GAAGH,MAAM,CAACI,MAAP,CAAc,UAACC,MAAD,EAASC,CAAT,EAAYC,CAAZ,EAAkB;AAAA,UAC1CC,IAD0C,GACjCF,CAAC,CAACb,KAD+B,CAC1Ce,IAD0C;;AAGlD,UAAIF,CAAC,CAACb,KAAF,CAAQO,MAAR,IAAkBQ,IAAtB,EAA4B;AAC1BH,QAAAA,MAAM,CAACG,IAAD,CAAN,GAAenB,aAAa,CAAC,CAAD,CAA5B;AACAa,QAAAA,aAAa,CAACK,CAAD,CAAb,GAAmBC,IAAnB;AACD;;AAED,aAAOH,MAAP;AACD,KATmB,EASjB,EATiB,CAApB;AAUAF,IAAAA,WAAW,CAACD,aAAZ,GAA4BA,aAA5B;AA7BiB,yBA+BmER,CA/BnE,CA+BTJ,WA/BS;AAAA,QA+BTA,WA/BS,+BA+BK,CA/BL;AAAA,QA+BQmB,iBA/BR,GA+BmEf,CA/BnE,CA+BQe,iBA/BR;AAAA,QA+B2BC,gBA/B3B,GA+BmEhB,CA/BnE,CA+B2BgB,gBA/B3B;AAAA,yBA+BmEhB,CA/BnE,CA+B6CiB,WA/B7C;AAAA,QA+B6CA,WA/B7C,+BA+B2D,GA/B3D;AAiCjB,UAAKH,IAAL,GAAY,UAAZ;AACA,UAAKC,iBAAL,GAAyBA,iBAAzB;AACA,UAAKC,gBAAL,GAAwBA,gBAAxB;AACA,UAAKC,WAAL,GAAmBA,WAAnB;AAEA,UAAKC,IAAL,GAAY,IAAZ;AACA,UAAKC,EAAL,GAAU,IAAV;AACA,UAAKC,YAAL,GAAoBC,qBAAqB,EAAzC;AAEA,UAAKC,kBAAL,GAA0BtB,CAAC,CAACsB,kBAAF,IAAwBrC,IAAlD;AACA,UAAKsC,kBAAL,GAA0BvB,CAAC,CAACuB,kBAAF,IAAwBtC,IAAlD;AACA,UAAKuC,gBAAL,GAAwBxB,CAAC,CAACwB,gBAAF,IAAsBvC,IAA9C;AAEA,KAAC,gBAAD,EAAmB,kBAAnB,EACA,oBADA,EACsB,YADtB,EACoC,cADpC,EAEA,UAFA,EAEYwC,OAFZ,CAEoB,UAAAC,CAAC;AAAA,aAAI,MAAKA,CAAL,IAAU,MAAKA,CAAL,EAAQC,IAAR,uDAAd;AAAA,KAFrB;AAIA,UAAKC,QAAL,GAAgB,KAAhB;AACA,UAAKC,WAAL,GAAmB,EAAnB;;AACA,UAAKC,WAAL,GAAmB,UAACC,KAAD,EAAW;AAC5B,YAAKF,WAAL,CAAiBE,KAAK,CAACjB,IAAvB,IAA+BiB,KAA/B;AACD,KAFD;;AAIA5C,IAAAA,GAAG,wDAAH;AAEA,UAAK6C,KAAL,GAAaC,MAAM,CAACC,MAAP,CAAc;AACzBC,MAAAA,aAAa,EAAE,KADU;AAEzBlC,MAAAA,MAAM,EAAE,IAFiB;AAGzBC,MAAAA,QAAQ,EAAE;AAHe,KAAd,EAIVO,WAJU,EAIGd,aAAa,CAACC,WAAD,CAJhB,CAAb;AA1DiB;AA+DlB;;;;wCAEmB;AAAA;;AAClB,WAAKwC,cAAL;AAEA,WAAKnC,MAAL,GAAcb,MAAM,CAACa,MAArB;AACA,WAAKC,QAAL,GAAgBd,MAAM,CAACc,QAAvB;AAEA,WAAKmC,QAAL,CAAc;AACZpC,QAAAA,MAAM,EAAEb,MAAM,CAACa,MADH;AAEZC,QAAAA,QAAQ,EAAEd,MAAM,CAACc;AAFL,OAAd,EAGG,YAAM;AACP,QAAA,MAAI,CAACoC,UAAL;AACD,OALD;AAMD;;;qCAEgB;AAAA,UACPF,cADO,GACY,KAAKrC,KADjB,CACPqC,cADO;;AAGf,UAAI,CAACA,cAAL,EAAqB;AACnB;AACD;;AALc,UAOPlC,QAPO,GAOMd,MAPN,CAOPc,QAPO;AAQfA,MAAAA,QAAQ,CAACT,eAAT,CAAyBF,KAAzB,CAA+BgD,QAA/B,GAA0C,QAA1C;AACArC,MAAAA,QAAQ,CAACR,IAAT,CAAcH,KAAd,CAAoBgD,QAApB,GAA+B,QAA/B;AACD;;;qCAEgB;AAAA,UACPrC,QADO,GACMd,MADN,CACPc,QADO;AAEfA,MAAAA,QAAQ,CAACT,eAAT,CAAyBF,KAAzB,CAA+BgD,QAA/B,GAA0C,MAA1C;AACArC,MAAAA,QAAQ,CAACR,IAAT,CAAcH,KAAd,CAAoBgD,QAApB,GAA+B,MAA/B;AACD;;;iCAEY;AAAA,UACHrB,IADG,GACgB,IADhB,CACHA,IADG;AAAA,UACGsB,QADH,GACgB,IADhB,CACGA,QADH;AAAA,UAEHC,eAFG,GAEiB,KAAK1C,KAFtB,CAEH0C,eAFG;;AAIX,UAAIA,eAAJ,EAAqB;AACnBxC,QAAAA,MAAM,CAACyC,gBAAP,CAAwB,SAAxB,EAAmCF,QAAQ,CAACb,IAAT,CAAc,IAAd,CAAnC;AACD;;AAED,UAAMR,EAAE,GAAG,IAAIhD,WAAJ,CAAgB;AACzBwE,QAAAA,MAAM,EAAEzB,IADiB;AAEzBH,QAAAA,iBAAiB,EAAE,KAAKA,iBAFC;AAGzBC,QAAAA,gBAAgB,EAAE,KAAKA,gBAHE;AAIzB4B,QAAAA,oBAAoB,EAAE,IAJG;AAKzBC,QAAAA,mBAAmB,EAAE,IALI;AAMzBC,QAAAA,QAAQ,EAAE,KAAKC,cANU;AAOzBC,QAAAA,OAAO,EAAE,KAAKD;AAPW,OAAhB,CAAX;AASA,WAAK5B,EAAL,GAAUA,EAAV;AACA,WAAKS,QAAL,GAAgB,IAAhB;AACD;;;yCAE+C;AAAA,UAAhCqB,SAAgC,QAAhCA,SAAgC;AAAA,UAArBC,MAAqB,QAArBA,MAAqB;AAAA,UAAbC,UAAa,QAAbA,UAAa;AAC9C,UAAMvC,CAAC,GAAG,KAAKoB,KAAf;AAD8C,qBAEpB,IAFoB,CAEtCb,EAFsC;AAAA,UAEtCA,EAFsC,yBAEjCiC,MAAM,EAF2B;;AAI9C,UAAIxC,CAAC,CAACuB,aAAN,EAAqB;AACnBhB,QAAAA,EAAE,CAACkC,KAAH;AACA,eAAOlC,EAAE,CAACmC,MAAH,EAAP;AACD;;AAED,UAAMC,GAAG,GAAG7E,UAAU,CAACuE,SAAD,CAAtB,CAT8C,CAW9C;;AACA,UAAIA,SAAS,KAAK,UAAlB,EAA8B;AAC5B,eAAO,KAAKO,gBAAL,CAAsBD,GAAG,CAACL,MAAD,CAAzB,EAAmCC,UAAnC,CAAP;AACD;;AAED,UAAIM,IAAI,GAAGN,UAAU,CAACM,IAAX,IAAoBN,UAAU,CAACrE,YAAX,IAA2BqE,UAAU,CAACrE,YAAX,EAA1D;;AAEA,UAAI,CAAC2E,IAAL,EAAW;AACT,YAAMC,YAAY,GAAG5E,YAAY,CAACqE,UAAU,CAACR,MAAZ,CAAjC;AACAc,QAAAA,IAAI,GAAGC,YAAP;AACD;;AAED,UAAMC,YAAY,GAAGF,IAAI,CAACG,IAAL,CAAU,UAAC5D,CAAD,EAAO;AACpC,YAAI,CAACA,CAAC,CAAC6D,OAAP,EAAgB;AACd,iBAAO,KAAP;AACD;;AAED,eAAO7D,CAAC,CAAC6D,OAAF,CAAU9B,KAAV,KAAoB,kBAA3B;AACD,OANoB,CAArB;;AAQA,UAAI,CAAC4B,YAAL,EAAmB;AACjBxC,QAAAA,EAAE,CAACkC,KAAH;AACA,eAAOlC,EAAE,CAACmC,MAAH,EAAP;AACD;;AAED,WAAKQ,kBAAL,CAAwBP,GAAG,CAACL,MAAD,CAA3B,EAAqCS,YAArC;AACD;;;qCAEgBT,M,EAAQ;AAAA;;AACvB,UAAMtC,CAAC,GAAG,KAAKoB,KAAf;AADuB,UAEf/B,MAFe,GAESW,CAFT,CAEfX,MAFe;AAAA,UAEPL,WAFO,GAESgB,CAFT,CAEPhB,WAFO;AAAA,UAGfU,MAHe,GAGJ,KAAKP,KAHD,CAGfO,MAHe;AAKvB,UAAMyD,IAAI,GAAGb,MAAM,KAAK,MAAX,GAAoBtD,WAAW,GAAG,CAAlC,GAAsCA,WAAW,GAAG,CAAjE;;AACA,UAAImE,IAAI,GAAG,CAAP,IAAYA,IAAI,GAAGzD,MAAM,CAACC,MAAP,GAAgB,CAAvC,EAA0C;AAAA,wBACd,IADc,CAChCY,EADgC;AAAA,YAChCA,EADgC,0BAC3BiC,MAAM,EADqB;AAExCjC,QAAAA,EAAE,CAACkC,KAAH;AACA,eAAOlC,EAAE,CAACmC,MAAH,EAAP;AACD;;AAED,UAAMU,EAAE,GAAGD,IAAI,GAAG9D,MAAM,CAACgE,WAAzB;AACA,UAAMC,QAAQ,GAAG;AACftE,QAAAA,WAAW,EAAEmE,IADE;AAEflE,QAAAA,UAAU,EAAED;AAFG,OAAjB;AAKA,WAAKyC,QAAL,CAAc;AAAEF,QAAAA,aAAa,EAAE;AAAjB,OAAd,EAAuC,YAAM;AAC3C,QAAA,MAAI,CAACgC,YAAL,CAAkB,MAAI,CAAC/C,YAAvB,EAAqC,WAArC,EAAkD4C,EAAlD,EAAsDE,QAAtD,EAAgE,MAAI,CAACpD,IAArE;AACD,OAFD;AAGD;;;uCAEkBoC,M,EAAQhC,I,EAAM;AAAA,UACvBJ,IADuB,GACdI,IAAI,CAAC2C,OADS,CACvB/C,IADuB;AAAA,UAEzBlB,WAFyB,GAET,KAAKoC,KAAL,CAAWlB,IAAX,CAFS,CAEzBlB,WAFyB;AAG/B,UAAImE,IAAI,GAAGb,MAAM,KAAK,OAAX,GAAqBtD,WAAW,GAAG,CAAnC,GAAuCA,WAAW,GAAG,CAAhE;AAH+B,UAIvBwE,UAJuB,GAIR,KAAKpC,KAAL,CAAW/B,MAJH,CAIvBmE,UAJuB;AAAA,sBAKL,IALK,CAKvBjD,EALuB;AAAA,UAKvBA,EALuB,0BAKlBiC,MAAM,EALY;AAO/B,UAAMiB,IAAI,GAAGlF,GAAG,CAAC0C,WAAJ,CAAgBf,IAAhB,CAAb;AACA,UAAMwD,EAAE,GAAGD,IAAI,CAACtE,KAAhB;AAR+B,UASvBI,QATuB,GASVmE,EATU,CASvBnE,QATuB;AAW/B,UAAIoE,KAAK,GAAG5F,QAAQ,CAAC,KAAKqD,KAAL,CAAW9B,QAAZ,qCAAiDY,IAAjD,QAApB;AAEA,UAAI0D,OAAO,GAAG5E,WAAW,GAAGwE,UAA5B;AACA,UAAIJ,EAAE,GAAGD,IAAI,GAAGK,UAAhB;AAEA,UAAMzD,MAAM,GAAG,KAAK8D,eAAL,CAAqBJ,IAArB,EAA2BzE,WAA3B,EAAwCmE,IAAxC,EAA8CS,OAA9C,EAAuDR,EAAvD,EAA2DO,KAA3D,CAAf;;AAEA,UAAI,CAAC5D,MAAL,EAAa;AACX+D,QAAAA,UAAU,CAAC,YAAM;AACfvD,UAAAA,EAAE,CAACkC,KAAH;AACAlC,UAAAA,EAAE,CAACmC,MAAH;AACD,SAHS,EAGPjE,OAHO,CAAV;AAIA;AACD;;AAEDmF,MAAAA,OAAO,GAAG7D,MAAM,CAAC6D,OAAjB;AACAT,MAAAA,IAAI,GAAGpD,MAAM,CAACoD,IAAd;AACAC,MAAAA,EAAE,GAAGrD,MAAM,CAACqD,EAAZ;;AAEA,UAAME,QAAQ,uBACXpD,IADW,EACJ;AACNlB,QAAAA,WAAW,EAAEmE,IADP;AAENlE,QAAAA,UAAU,EAAED;AAFN,OADI,CAAd;;AAOA,WAAK+E,gBAAL,CAAsB7D,IAAtB,EAA4BI,IAA5B,EAAkCqD,KAAlC,EAAyCC,OAAzC,EAAkDR,EAAlD,EAAsDD,IAAtD,EAA4DG,QAA5D,EAAsE/D,QAAtE;AACD;;;oCAEekE,I,EAAMzE,W,EAAamE,I,EAAMS,O,EAASR,E,EAAIO,K,EAAO;AAC3D,UAAMD,EAAE,GAAGD,IAAI,CAACtE,KAAhB;AAD2D,UAEnDI,QAFmD,GAEzBmE,EAFyB,CAEnDnE,QAFmD;AAAA,UAEzCC,WAFyC,GAEzBkE,EAFyB,CAEzClE,WAFyC;AAAA,UAGnDgE,UAHmD,GAGpC,KAAKpC,KAAL,CAAW/B,MAHyB,CAGnDmE,UAHmD;AAK3D,UAAMQ,GAAG,GAAGL,KAAK,CAAChE,MAAlB;AAEA,UAAMsE,QAAQ,GAAGjF,WAAW,KAAK,CAAhB,IAAqBmE,IAAI,KAAK,CAAC,CAAhD;AACA,UAAMe,MAAM,GAAGlF,WAAW,KAAKgF,GAAG,GAAG,CAAtB,IAA2Bb,IAAI,KAAKa,GAAnD;;AAEA,UAAI,CAACzE,QAAD,IAAa,CAACC,WAAd,KAA8ByE,QAAQ,IAAIC,MAA1C,CAAJ,EAAuD;AACrD,eAAO,IAAP;AACD;;AAED,UAAI3E,QAAQ,IAAI0E,QAAhB,EAA0B;AACxB;AACAd,QAAAA,IAAI,GAAGa,GAAG,GAAG,CAAb;AACAG,QAAAA,WAAW,CAACR,KAAD,CAAX;AACAC,QAAAA,OAAO,GAAGJ,UAAV;AACAJ,QAAAA,EAAE,GAAG,CAAL;AACD,OAND,MAMO,IAAI7D,QAAQ,IAAI2E,MAAhB,EAAwB;AAC7B;AACAf,QAAAA,IAAI,GAAG,CAAP;AACAgB,QAAAA,WAAW,CAACR,KAAD,CAAX;AACAC,QAAAA,OAAO,GAAG,CAAV;AACAR,QAAAA,EAAE,GAAGI,UAAL;AACD;;AAED,UAAMzD,MAAM,GAAG;AAAEoD,QAAAA,IAAI,EAAJA,IAAF;AAAQS,QAAAA,OAAO,EAAPA,OAAR;AAAiBR,QAAAA,EAAE,EAAFA;AAAjB,OAAf;AACA,aAAOrD,MAAP;AACD;;;qCAEgBG,I,EAAMI,I,EAAMqD,K,EAAOC,O,EAASR,E,EAAID,I,EAAMG,Q,EAAU/D,Q,EAAU;AAAA;;AACzEvB,MAAAA,OAAO,CAAC2F,KAAD,CAAP;AACArD,MAAAA,IAAI,CAAC8D,UAAL,GAAkBR,OAAlB,CAFyE,CAIzE;AACA;AACA;;AAEA,WAAKnC,QAAL,CAAc;AAAEF,QAAAA,aAAa,EAAE;AAAjB,OAAd,EAAuC,YAAM;AAC3C,QAAA,MAAI,CAACgC,YAAL,CAAkBjD,IAAlB,EAAwB,YAAxB,EAAsC8C,EAAtC,EAA0CE,QAA1C,EAAoDpD,IAApD,EAA0D,YAAM;AAC9D,cAAIX,QAAJ,EAAc;AACZ8E,YAAAA,WAAW,CAACV,KAAD,CAAX;AACArD,YAAAA,IAAI,CAAC8D,UAAL,GAAkBZ,UAAU,GAAGL,IAA/B;AACD;;AACDlF,UAAAA,gBAAgB,CAACkF,IAAD,EAAOQ,KAAP,CAAhB;AACD,SAND;AAOD,OARD;AASD;;;iCAEYrD,I,EAAMgE,O,EAASlB,E,EAAIE,Q,EAAUiB,Q,EAAqB;AAAA;;AAAA,UAAXC,EAAW,uEAANnG,IAAM;AAC7D,UAAMkC,EAAE,GAAG,KAAKA,EAAL,IAAWiC,MAAM,EAA5B;AACAjC,MAAAA,EAAE,CAACkC,KAAH;AACA,UAAMgC,WAAW,GAAG,KAAK9D,kBAAL,CAAwB4D,QAAxB,EAAkC,KAAKpF,KAAvC,EAA8C,KAAKiC,KAAnD,EAA0DkC,QAAQ,CAACiB,QAAD,CAAR,IAAsBjB,QAAhF,CAApB;;AAEA,UAAImB,WAAW,KAAK,IAApB,EAA0B;AACxB;AACD;;AAED7G,MAAAA,QAAQ,CAAC0C,IAAD,EAAOgE,OAAP,EAAgBlB,EAAhB,EAAoB,KAAK/C,WAAzB,EAAsC,YAAM;AAClDiD,QAAAA,QAAQ,CAAC/B,aAAT,GAAyB,KAAzB;;AACA,QAAA,MAAI,CAACE,QAAL,CAAc6B,QAAd,EAAwB,YAAM;AAC5BkB,UAAAA,EAAE;;AACF,UAAA,MAAI,CAAC5D,gBAAL,CAAsB2D,QAAtB,EAAgC,MAAI,CAACpF,KAArC,EAA4C,MAAI,CAACiC,KAAjD,EAAwDkC,QAAQ,CAACiB,QAAD,CAAR,IAAsBjB,QAA9E;;AACAQ,UAAAA,UAAU,CAAC,YAAM;AACfvD,YAAAA,EAAE,CAACkC,KAAH;AACAlC,YAAAA,EAAE,CAACmC,MAAH;AACD,WAHS,EAGPjE,OAHO,CAAV;AAID,SAPD;AAQD,OAVO,CAAR;AAWD;;;2CAEsB;AACrB,UAAM8B,EAAE,GAAG,KAAKA,EAAL,IAAWiC,MAAM,EAA5B;AACAjC,MAAAA,EAAE,CAACmE,OAAH;AACA,WAAKnE,EAAL,GAAU,IAAV;AAHqB,UAKblB,MALa,GAKF,KAAK+B,KALH,CAKb/B,MALa;;AAOrB,UAAI,KAAKF,KAAL,CAAW0C,eAAf,EAAgC;AAC9BxC,QAAAA,MAAM,CAACsF,mBAAP,CAA2B,SAA3B,EAAsC,KAAK/C,QAA3C;AACD;;AAED,UAAI,KAAKzC,KAAL,CAAWqC,cAAf,EAA+B;AAC7B,aAAKoD,cAAL;AACD;AACF;;;6BAEQC,C,EAAG;AACV,UAAMxC,SAAS,GAAG/D,OAAO,CAACuG,CAAC,CAACC,OAAH,CAAzB;;AACA,UAAI,CAACzC,SAAL,EAAgB;AACd;AACD;;AAED,UAAMC,MAAM,GAAID,SAAS,KAAK,IAAd,IAAsBA,SAAS,KAAK,MAArC,GAA+C,CAAC,CAAhD,GAAoD,CAAnE;AACA,UAAM0C,OAAO,GAAI1C,SAAS,KAAK,IAAd,IAAsBA,SAAS,KAAK,MAArC,GAA+C,UAA/C,GAA4D,YAA5E;;AAEA,UAAI0C,OAAO,KAAK,UAAhB,EAA4B;AAC1B7F,QAAAA,QAAQ,CAAC8F,mBAAT,CAA6B,KAAK5D,KAAL,CAAWpC,WAAX,GAAyBsD,MAAtD;AACA;AACD;;AAED,UAAM2C,cAAc,GAAG,KAAK7D,KAAL,CAAWxB,aAAX,CAAyB,KAAKwB,KAAL,CAAWpC,WAApC,CAAvB;;AACA,UAAI,CAACiG,cAAL,EAAqB;AACnB;AACD;;AAjBS,UAmBFjG,WAnBE,GAmBc,KAAKoC,KAAL,CAAW6D,cAAX,CAnBd,CAmBFjG,WAnBE;AAoBVE,MAAAA,QAAQ,CAACgG,qBAAT,CAA+BD,cAA/B,EAA+CjG,WAAW,GAAGsD,MAA7D;AACD;;;6BAgEQ;AAAA;;AACP,UAAMtC,CAAC,GAAG,KAAKoB,KAAf;AACA,UAAMhC,CAAC,GAAG,KAAKD,KAAf;AAFO,UAGCE,MAHD,GAGmCW,CAHnC,CAGCX,MAHD;AAAA,UAGSC,QAHT,GAGmCU,CAHnC,CAGSV,QAHT;AAAA,UAGmBN,WAHnB,GAGmCgB,CAHnC,CAGmBhB,WAHnB;AAKP,UAAMmG,QAAQ,GAAG/F,CAAC,CAAC+F,QAAF,IAAc,IAA/B;;AAEA,UAAI,CAAC9F,MAAL,EAAa;AACX,eAAO8F,QAAP;AACD;;AAED,UAAMC,QAAQ,GAAGhG,CAAC,CAACM,MAAF,CAASI,MAAT,CAAgB,UAACC,MAAD,EAASsF,EAAT,EAAgB;AAC/C,YAAI,CAACA,EAAL,EAAS;AACP,iBAAOtF,MAAP;AACD;;AAED,YAAI,OAAOsF,EAAE,CAACC,IAAV,KAAmB,UAAvB,EAAmC;AACjCvF,UAAAA,MAAM,CAACwF,KAAP,CAAaC,IAAb,CAAkBH,EAAlB;AACD,SAFD,MAEO;AACLtF,UAAAA,MAAM,CAACL,MAAP,CAAc8F,IAAd,CAAmBH,EAAnB;AACD;;AAED,eAAOtF,MAAP;AACD,OAZgB,EAYd;AAAEL,QAAAA,MAAM,EAAE,EAAV;AAAc6F,QAAAA,KAAK,EAAE;AAArB,OAZc,CAAjB;AAXO,UAyBCA,KAzBD,GAyBmBH,QAzBnB,CAyBCG,KAzBD;AAAA,UAyBQ7F,MAzBR,GAyBmB0F,QAzBnB,CAyBQ1F,MAzBR,EA2BP;;AACA,aACI,oBAAC,UAAD;AACE,QAAA,MAAM,EAAE,uBAAuB;AAAA,cAApB+F,KAAoB,SAApBA,KAAoB;AAAA,cAAbC,MAAa,SAAbA,MAAa;AAE7B,cAAMtC,EAAE,GAAGpE,WAAW,GAAG0G,MAAzB;AACA5B,UAAAA,UAAU,CAAC,YAAM;AACf,YAAA,MAAI,CAACtD,YAAL,CAAkBmF,SAAlB,GAA8BvC,EAA9B;AACD,WAFS,EAEP,CAFO,CAAV;AAIA,iBACE;AAAK,YAAA,GAAG,EAAE,aAAA9C,IAAI;AAAA,qBAAK,MAAI,CAACA,IAAL,GAAYA,IAAjB;AAAA,aAAd;AAAsC,YAAA,SAAS,EAAC,UAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACG6E,QADH,EAEGI,KAAK,CAACK,GAAN,CAAU,UAACC,CAAD,EAAI5F,CAAJ,EAAU;AACnB,gBAAM6F,EAAE,GAAGD,CAAC,CAAC1G,KAAF,IAAW,EAAtB;AACA,mBAAO;AAAK,cAAA,GAAG,EAAEc;AAAV,eAAiB6F,EAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAP;AACD,WAHA,CAFH,EAOGpG,MAAM,CAACkG,GAAP,CAAW,UAACP,EAAD,EAAKpF,CAAL,EAAW;AACrB,gBAAM8F,EAAE,GAAGV,EAAE,CAAClG,KAAH,IAAY,EAAvB;AACA,gBAAMgG,QAAQ,GAAGY,EAAE,CAACZ,QAApB;;AAEA,gBAAIY,EAAE,CAACrG,MAAP,EAAe;AAAA,kBACLQ,IADK,GACI6F,EADJ,CACL7F,IADK;AAEb,qBAAO,oBAAC,gBAAD;AAAkB,gBAAA,KAAK,EAAE,MAAI,CAACgB,WAAL,CAAiBH,IAAjB,CAAsB,MAAtB,CAAzB;AAAsD,gBAAA,KAAK,EAAE0E,KAA7D;AAAoE,gBAAA,MAAM,EAAEC,MAA5E;AAAoF,gBAAA,MAAM,EAAErG,MAA5F;AAAoG,gBAAA,QAAQ,EAAEC,QAA9G;AAAwH,gBAAA,WAAW,EAAEU,CAAC,CAACE,IAAD,CAAD,CAAQlB,WAA7I;AAA0J,gBAAA,cAAc,EAAEI,CAAC,CAACoC;AAA5K,iBAAgMuE,EAAhM;AAAoM,gBAAA,GAAG,EAAE9F,CAAzM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACFkF,QADE,CAAP;AAGD;;AAED,mBAAO,oBAAC,KAAD;AAAO,cAAA,MAAM,EAAE,IAAf;AAAqB,cAAA,SAAS,EAAEY,EAAE,CAACC,SAAH,IAAgB,EAAhD;AAAoD,cAAA,EAAE,EAAED,EAAE,CAACE,EAA3D;AAA+D,cAAA,KAAK,EAAER,KAAtE;AAA6E,cAAA,MAAM,EAAEC,MAArF;AAA6F,cAAA,GAAG,EAAEzF;AAAlG,eAAyG8F,EAAzG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACFZ,QADE,CAAP;AAGD,WAdA,CAPH,CADF;AAyBD,SAjCH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ;AAqCD;;;0CA/H4BjF,I,EAAMiD,I,EAAM;AACvCA,MAAAA,IAAI,GAAG,CAACA,IAAR;AAEA,UAAMM,IAAI,GAAGlF,GAAG,CAAC0C,WAAJ,CAAgBf,IAAhB,CAAb;;AACA,UAAI,CAACuD,IAAL,EAAW;AACT,cAAMhE,KAAK,CAAC,qCAAD,EAAwCS,IAAxC,CAAX;AACD;;AANsC,UAQ/BI,IAR+B,GAQfmD,IARe,CAQ/BnD,IAR+B;AAAA,UAQzBnB,KARyB,GAQfsE,IARe,CAQzBtE,KARyB;AAAA,UAS/BI,QAT+B,GASlBJ,KATkB,CAS/BI,QAT+B;AAUvC,UAAM2G,QAAQ,GAAGC,UAAU,CAAChD,IAAD,EAAOhE,KAAP,EAAcZ,GAAG,CAAC6C,KAAlB,CAA3B;;AAEA,UAAI,CAAC8E,QAAL,EAAe;AACb;AACD;;AAdsC,UAgB/BlH,WAhB+B,GAgBfT,GAAG,CAAC6C,KAAJ,CAAUlB,IAAV,CAhBe,CAgB/BlB,WAhB+B;AAAA,UAiB/BwE,UAjB+B,GAiBhBjF,GAAG,CAAC6C,KAAJ,CAAU/B,MAjBM,CAiB/BmE,UAjB+B;AAmBvC,UAAIG,KAAK,GAAG5F,QAAQ,CAACQ,GAAG,CAAC6C,KAAJ,CAAU9B,QAAX,qCAAgDY,IAAhD,QAApB;AACA,UAAI0D,OAAO,GAAG5E,WAAW,GAAGwE,UAA5B;AACA,UAAIJ,EAAE,GAAGD,IAAI,GAAGK,UAAhB;;AAEA,UAAMzD,MAAM,GAAGxB,GAAG,CAACsF,eAAJ,CAAoBuC,IAApB,CAAyB7H,GAAzB,EAA8BkF,IAA9B,EAAoCzE,WAApC,EAAiDmE,IAAjD,EAAuDS,OAAvD,EAAgER,EAAhE,EAAoEO,KAApE,CAAf;;AAEAC,MAAAA,OAAO,GAAG7D,MAAM,CAAC6D,OAAjB;AACAT,MAAAA,IAAI,GAAGpD,MAAM,CAACoD,IAAd;AACAC,MAAAA,EAAE,GAAGrD,MAAM,CAACqD,EAAZ;;AAEA,UAAME,QAAQ,uBACXpD,IADW,EACJ;AACNlB,QAAAA,WAAW,EAAEmE,IADP;AAENlE,QAAAA,UAAU,EAAED;AAFN,OADI,CAAd;;AAOAT,MAAAA,GAAG,CAACwF,gBAAJ,CAAqBqC,IAArB,CAA0B7H,GAA1B,EAA+B2B,IAA/B,EAAqCI,IAArC,EAA2CqD,KAA3C,EAAkDC,OAAlD,EAA2DR,EAA3D,EAA+DD,IAA/D,EAAqEG,QAArE,EAA+E/D,QAA/E;AACD;;;wCAE0B8G,G,EAAK;AAAA,iBACe9H,GADf;AAAA,UACtBY,KADsB,QACtBA,KADsB;AAAA,UACfiC,KADe,QACfA,KADe;AAAA,UACRlB,IADQ,QACRA,IADQ;AAAA,UACFM,YADE,QACFA,YADE;AAAA,UAEtBxB,WAFsB,GAEEoC,KAFF,CAEtBpC,WAFsB;AAAA,UAETK,MAFS,GAEE+B,KAFF,CAET/B,MAFS;AAI9B,UAAM6G,QAAQ,GAAGC,UAAU,CAACE,GAAD,EAAMlH,KAAN,EAAaiC,KAAb,CAA3B;;AAEA,UAAI,CAAC8E,QAAL,EAAe;AACb;AACD;;AAED,UAAM5C,QAAQ,GAAG;AACftE,QAAAA,WAAW,EAAEqH,GADE;AAEfpH,QAAAA,UAAU,EAAED;AAFG,OAAjB;AAKA,UAAMoE,EAAE,GAAGiD,GAAG,GAAGhH,MAAM,CAACgE,WAAxB;;AAEA9E,MAAAA,GAAG,CAACkD,QAAJ,CAAa;AAAEF,QAAAA,aAAa,EAAE;AAAjB,OAAb,EAAsC,YAAM;AAC1ChD,QAAAA,GAAG,CAACoC,kBAAJ,CAAuBT,IAAvB,EAA6Bf,KAA7B,EAAoCiC,KAApC,EAA2CkC,QAA3C;;AACA/E,QAAAA,GAAG,CAACgF,YAAJ,CAAiB/C,YAAjB,EAA+B,WAA/B,EAA4C4C,EAA5C,EAAgDE,QAAhD,EAA0DpD,IAA1D;AACD,OAHD;AAID;;;;EAzYoB5C,KAAK,CAACgJ,S;;AA+c7B,SAASC,IAAT,CAAc5C,KAAd,EAAqBkC,CAArB,EAAwB5F,CAAxB,EAA2B;AACzB0D,EAAAA,KAAK,CAACkC,CAAC,IAAI5F,CAAN,CAAL,CAAcuG,UAAd,CAAyBC,YAAzB,CAAsC9C,KAAK,CAAC1D,CAAD,CAA3C,EAAgD0D,KAAK,CAACkC,CAAD,CAArD;AACA,SAAOlC,KAAP;AACD;;AAED,SAASQ,WAAT,CAAqBR,KAArB,EAA4B;AAC1B4C,EAAAA,IAAI,CAAC5C,KAAD,EAAQ,CAAR,EAAWA,KAAK,CAAChE,MAAN,GAAe,CAA1B,CAAJ;AACD;;AAED,SAAS0E,WAAT,CAAqBV,KAArB,EAA4B;AAC1B4C,EAAAA,IAAI,CAAC5C,KAAD,EAAQ,IAAR,EAAcA,KAAK,CAAChE,MAAN,GAAe,CAA7B,CAAJ;AACD;;AAED,SAASwG,UAAT,CAAoBE,GAApB,EAAyBlH,KAAzB,EAAgCiC,KAAhC,EAAuC;AAAA,MAC7B1B,MAD6B,GAClBP,KADkB,CAC7BO,MAD6B;AAAA,MAE7BV,WAF6B,GAEboC,KAFa,CAE7BpC,WAF6B;;AAIrC,MAAIoC,KAAK,CAACG,aAAV,EAAyB;AACvB,WAAO,KAAP;AACD;;AAED,MAAIpC,KAAK,CAACI,QAAV,EAAoB;AAClB,WAAO,IAAP;AACD;;AAED,MAAI8G,GAAG,GAAG3G,MAAM,CAACC,MAAP,GAAgB,CAAtB,IAA2B0G,GAAG,GAAG,CAArC,EAAwC;AACtC,WAAO,KAAP;AACD;;AAED,MAAIA,GAAG,IAAIrH,WAAX,EAAwB;AACtB,WAAO,KAAP;AACD;;AAED,SAAO,IAAP;AACD;;AAED,SAASwD,MAAT,GAAkB;AAChB,SAAO;AACLC,IAAAA,KAAK,EAAEpE,IADF;AAELqG,IAAAA,OAAO,EAAErG,IAFJ;AAGLqE,IAAAA,MAAM,EAAErE;AAHH,GAAP;AAKD;;AAED,SAASoC,qBAAT,GAAiC;AAC/B,MAAIiG,SAAJ,EAAeC,QAAf;AAD+B,MAGvBrH,QAHuB,GAGVd,MAHU,CAGvBc,QAHuB;;AAK/B,MAAI,OAAOsH,SAAP,KAAqB,WAArB,IAAoCA,SAAxC,EAAmD;AAAA,qBACtBA,SADsB;AAC9CF,IAAAA,SAD8C,cAC9CA,SAD8C;AACnCC,IAAAA,QADmC,cACnCA,QADmC;AAElD;;AAED,MAAI,CAACD,SAAL,EAAgB;AACd,WAAOpH,QAAQ,CAACR,IAAhB;AACD,GAX8B,CAa/B;;;AACA,MAAI,mBAAmB+H,IAAnB,CAAwBH,SAAxB,CAAJ,EAAwC;AACtC,WAAOpH,QAAQ,CAACR,IAAhB;AACD;;AAED,MAAMgI,OAAO,GAAGpJ,aAAa,CAACgJ,SAAD,CAA7B;;AAEA,MAAI,CAACI,OAAL,EAAc;AACZ,WAAOxH,QAAQ,CAACR,IAAhB;AACD,GAtB8B,CAwB/B;AACA;AACA;;;AA1B+B,MA4BvBoB,IA5BuB,GA4BD4G,OA5BC,CA4BvB5G,IA5BuB;AAAA,MA4BjB6G,OA5BiB,GA4BDD,OA5BC,CA4BjBC,OA5BiB;AAAA,MA4BRC,EA5BQ,GA4BDF,OA5BC,CA4BRE,EA5BQ,EA4BQ;;AA5BR,uBA6BCD,OAAO,CAACE,KAAR,CAAc,GAAd,CA7BD;AAAA;AAAA,MA6BvBC,KA7BuB;AAAA,MA6BhBC,KA7BgB;AAAA,MA6BTC,KA7BS,uBA6BqB;;;AAEpD,MAAMC,aAAa,GAAG,IAAIC,GAAJ,CAAQ,CAC5B,SAD4B,EAE5B,QAF4B,EAG5B,KAH4B,EAGrB;AACP,SAJ4B,EAInB;AACT,MAL4B,CAAR,CAAtB,CA/B+B,CAuC/B;AACA;AACA;;AACA,MAAMC,oBAAoB,GAAG,IAAID,GAAJ,CAAQ,CACnC,QADmC,EAEnC,MAFmC,CAAR,CAA7B;;AAKA,MAAID,aAAa,CAACG,GAAd,CAAkBtH,IAAlB,KAA2B,CAACqH,oBAAoB,CAACC,GAArB,CAAyBb,QAAzB,CAAhC,EAAoE;AAChE,WAAOrH,QAAQ,CAACT,eAAhB;AACH,GAjD8B,CAmD/B;;;AACA,SAAOS,QAAQ,CAACR,IAAhB;AACD;;AACD,eAAeI,QAAf","sourcesContent":["import React from 'react';\nimport ScrollSwipe from 'scroll-swipe';\nimport root from 'window-or-global';\nimport { WindowSize } from 'react-fns';\n\nimport { detectBrowser, constants, scrollTo, renderUtils, INTENT_MAP, getNodes, showAll, hideAllButActive, composedPath } from '../utils';\nimport Slide from './Slide';\nimport HorizontalSlider from './HorizontalSlider';\n\nconst { noOp } = constants;\nconst { KEY_IDX } = renderUtils;\n\nlet _fp = {};\nlet global = {};\n\nconst TIMEOUT = 200;\n\nconst documentStub = () => {\n  const style = {};\n  return {\n    querySelectorAll: () => [<div></div>],\n    documentElement: {\n      style\n    },\n    body: {\n      style\n    }\n  };\n}\n\nfunction generateState(activeSlide = 0) {\n  return {\n    activeSlide,\n    lastActive: activeSlide - 1\n  };\n}\n\nclass Fullpage extends React.Component {\n  constructor(props) {\n    super(props);\n    const p = this.props;\n\n    global.window = root;\n    global.document = global.window.document || documentStub();\n\n    if (p.infinite && p.resetSlides) {\n      throw new Error('Fullpage Component cannot have both infinite and resetSlides as truthy props');\n    }\n\n    const { slides } = p;\n\n    if (!slides || !slides.length) {\n      throw new Error('Please provide slides for Fullpage');\n    }\n\n    let horizontalMap = {};\n    // generate state for horizontals;\n    const horizontals = slides.reduce((result, s, i) => {\n      const { name } = s.props;\n\n      if (s.props.slides && name) {\n        result[name] = generateState(0);\n        horizontalMap[i] = name;\n      }\n\n      return result;\n    }, {});\n    horizontals.horizontalMap = horizontalMap;\n\n    const { activeSlide = 0, scrollSensitivity, touchSensitivity, scrollSpeed = 500 } = p;\n\n    this.name = 'Fullpage';\n    this.scrollSensitivity = scrollSensitivity;\n    this.touchSensitivity = touchSensitivity;\n    this.scrollSpeed = scrollSpeed;\n\n    this.node = null;\n    this.ss = null;\n    this.verticalRoot = determineVerticalRoot();\n\n    this.onHorizontalChange = p.onHorizontalChange || noOp;\n    this.onSlideChangeStart = p.onSlideChangeStart || noOp;\n    this.onSlideChangeEnd = p.onSlideChangeEnd || noOp;\n\n    ['onScrollAction', 'onVerticalScroll',\n    'onHorizontalScroll', 'lockScroll', 'handleScroll',\n    'checkKey'].forEach(f => this[f] = this[f].bind(this));\n\n    this.isLocked = false;\n    this.hSlideCache = {};\n    this.cacheHslide = (slide) => {\n      this.hSlideCache[slide.name] = slide;\n    }\n\n    _fp = this;\n\n    this.state = Object.assign({\n      scrollPending: false,\n      window: null,\n      document: null\n    }, horizontals, generateState(activeSlide));\n  }\n\n  componentDidMount() {\n    this.hideScrollBars();\n\n    this.window = global.window;\n    this.document = global.document;\n\n    this.setState({\n      window: global.window,\n      document: global.document\n    }, () => {\n      this.lockScroll();\n    });\n  }\n\n  hideScrollBars() {\n    const { hideScrollBars } = this.props;\n\n    if (!hideScrollBars) {\n      return;\n    }\n\n    const { document } = global;\n    document.documentElement.style.overflow = 'hidden';\n    document.body.style.overflow = 'hidden';\n  }\n\n  showScrollBars() {\n    const { document } = global;\n    document.documentElement.style.overflow = 'auto';\n    document.body.style.overflow = 'auto';\n  }\n\n  lockScroll() {\n    const { node, checkKey } = this;\n    const { enableArrowKeys } = this.props;\n\n    if (enableArrowKeys) {\n      window.addEventListener('keydown', checkKey.bind(this));\n    }\n\n    const ss = new ScrollSwipe({\n      target: node,\n      scrollSensitivity: this.scrollSensitivity,\n      touchSensitivity: this.touchSensitivity,\n      scrollPreventDefault: true,\n      touchPreventDefault: true,\n      scrollCb: this.onScrollAction,\n      touchCb: this.onScrollAction\n    });\n    this.ss = ss;\n    this.isLocked = true;\n  }\n\n  onScrollAction({direction, intent, startEvent}) {\n    const s = this.state;\n    const { ss = ssStub() } = this;\n\n    if (s.scrollPending) {\n      ss.flush();\n      return ss.listen();\n    }\n\n    const dir = INTENT_MAP[direction];\n\n    // at this point we are dedicating\n    if (direction === 'VERTICAL') {\n      return this.onVerticalScroll(dir[intent], startEvent);\n    }\n\n    let path = startEvent.path || (startEvent.composedPath && startEvent.composedPath());\n\n    if (!path) {\n      const polyFillPath = composedPath(startEvent.target);\n      path = polyFillPath;\n    }\n\n    const isHorizontal = path.find((p) => {\n      if (!p.dataset) {\n        return false;\n      }\n\n      return p.dataset.slide === 'HorizontalSlider';\n    });\n\n    if (!isHorizontal) {\n      ss.flush();\n      return ss.listen();\n    }\n\n    this.onHorizontalScroll(dir[intent], isHorizontal);\n  }\n\n  onVerticalScroll(intent) {\n    const s = this.state;\n    const { window, activeSlide } = s;\n    const { slides } = this.props;\n\n    const next = intent === 'DOWN' ? activeSlide + 1 : activeSlide - 1;\n    if (next < 0 || next > slides.length - 1) {\n      const { ss = ssStub() } = this;\n      ss.flush();\n      return ss.listen();\n    }\n\n    const to = next * window.innerHeight;\n    const newState = {\n      activeSlide: next,\n      lastActive: activeSlide\n    };\n\n    this.setState({ scrollPending: true }, () => {\n      this.handleScroll(this.verticalRoot, 'scrollTop', to, newState, this.name);\n    });\n  }\n\n  onHorizontalScroll(intent, node) {\n    const { name } = node.dataset;\n    let { activeSlide } = this.state[name];\n    let next = intent === 'RIGHT' ? activeSlide + 1 : activeSlide - 1;\n    const { innerWidth } = this.state.window;\n    const { ss = ssStub() } = this;\n\n    const comp = _fp.hSlideCache[name];\n    const hp = comp.props;\n    const { infinite } = hp;\n\n    let nodes = getNodes(this.state.document, `data-horizontal-slider=\"${name}\"`);\n\n    let leftVal = activeSlide * innerWidth;\n    let to = next * innerWidth;\n\n    const result = this.determineHSlide(comp, activeSlide, next, leftVal, to, nodes);\n\n    if (!result) {\n      setTimeout(() => {\n        ss.flush();\n        ss.listen();\n      }, TIMEOUT);\n      return;\n    }\n\n    leftVal = result.leftVal\n    next = result.next;\n    to = result.to;\n\n    const newState = {\n      [name]: {\n        activeSlide: next,\n        lastActive: activeSlide\n      }\n    };\n\n    this.handleHorizontal(name, node, nodes, leftVal, to, next, newState, infinite);\n  }\n\n  determineHSlide(comp, activeSlide, next, leftVal, to, nodes) {\n    const hp = comp.props;\n    const { infinite, resetSlides } = hp;\n    const { innerWidth } = this.state.window;\n\n    const len = nodes.length;\n\n    const infStart = activeSlide === 0 && next === -1;\n    const infEnd = activeSlide === len - 1 && next === len;\n\n    if (!infinite && !resetSlides && (infStart || infEnd)) {\n      return null;\n    }\n\n    if (infinite && infStart) {\n      // simulate last <- 0\n      next = len - 1;\n      lastToFirst(nodes);\n      leftVal = innerWidth;\n      to = 0;\n    } else if (infinite && infEnd) {\n      // simulate last -> 0\n      next = 0;\n      lastToFirst(nodes);\n      leftVal = 0;\n      to = innerWidth;\n    }\n\n    const result = { next, leftVal, to };\n    return result;\n  }\n\n  handleHorizontal(name, node, nodes, leftVal, to, next, newState, infinite) {\n    showAll(nodes);\n    node.scrollLeft = leftVal;\n\n    //show, reset window\n    //scroll\n    //hide\n\n    this.setState({ scrollPending: true }, () => {\n      this.handleScroll(node, 'scrollLeft', to, newState, name, () => {\n        if (infinite) {\n          firstToLast(nodes);\n          node.scrollLeft = innerWidth * next;\n        }\n        hideAllButActive(next, nodes);\n      });\n    });\n  }\n\n  handleScroll(node, winProp, to, newState, compName, cb = noOp) {\n    const ss = this.ss || ssStub();\n    ss.flush();\n    const cancellable = this.onSlideChangeStart(compName, this.props, this.state, newState[compName] || newState);\n\n    if (cancellable === true) {\n      return;\n    }\n\n    scrollTo(node, winProp, to, this.scrollSpeed, () => {\n      newState.scrollPending = false;\n      this.setState(newState, () => {\n        cb();\n        this.onSlideChangeEnd(compName, this.props, this.state, newState[compName] || newState);\n        setTimeout(() => {\n          ss.flush();\n          ss.listen();\n        }, TIMEOUT);\n      });\n    });\n  }\n\n  componentWillUnmount() {\n    const ss = this.ss || ssStub();\n    ss.killAll();\n    this.ss = null;\n\n    const { window } = this.state;\n\n    if (this.props.enableArrowKeys) {\n      window.removeEventListener('keydown', this.checkKey);\n    }\n\n    if (this.props.hideScrollBars) {\n      this.showScrollBars();\n    }\n  }\n\n  checkKey(e) {\n    const direction = KEY_IDX[e.keyCode];\n    if (!direction) {\n      return;\n    }\n\n    const intent = (direction === 'UP' || direction === 'LEFT') ? -1 : 1;\n    const context = (direction === 'UP' || direction === 'DOWN') ? 'VERTICAL' : 'HORIZONTAL';\n\n    if (context === 'VERTICAL') {\n      Fullpage.changeFullpageSlide(this.state.activeSlide + intent);\n      return;\n    }\n\n    const horizontalName = this.state.horizontalMap[this.state.activeSlide];\n    if (!horizontalName) {\n      return;\n    }\n\n    const { activeSlide } = this.state[horizontalName];\n    Fullpage.changeHorizontalSlide(horizontalName, activeSlide + intent);\n  }\n\n  static changeHorizontalSlide(name, next) {\n    next = +next;\n\n    const comp = _fp.hSlideCache[name];\n    if (!comp) {\n      throw Error('cannt find HorizontalSlider by name', name);\n    }\n\n    const { node, props } = comp;\n    const { infinite } = props;\n    const eligible = isEligible(next, props, _fp.state);\n\n    if (!eligible) {\n      return;\n    }\n\n    const { activeSlide } = _fp.state[name];\n    const { innerWidth } = _fp.state.window;\n\n    let nodes = getNodes(_fp.state.document, `data-horizontal-slider=\"${name}\"`);\n    let leftVal = activeSlide * innerWidth;\n    let to = next * innerWidth;\n\n    const result = _fp.determineHSlide.call(_fp, comp, activeSlide, next, leftVal, to, nodes);\n\n    leftVal = result.leftVal\n    next = result.next;\n    to = result.to;\n\n    const newState = {\n      [name]: {\n        activeSlide: next,\n        lastActive: activeSlide\n      }\n    };\n\n    _fp.handleHorizontal.call(_fp, name, node, nodes, leftVal, to, next, newState, infinite);\n  }\n\n  static changeFullpageSlide(idx) {\n    const { props, state, name, verticalRoot } = _fp;\n    const { activeSlide, window } = state;\n\n    const eligible = isEligible(idx, props, state);\n\n    if (!eligible) {\n      return;\n    }\n\n    const newState = {\n      activeSlide: idx,\n      lastActive: activeSlide\n    };\n\n    const to = idx * window.innerHeight;\n\n    _fp.setState({ scrollPending: true }, () => {\n      _fp.onSlideChangeStart(name, props, state, newState);\n      _fp.handleScroll(verticalRoot, 'scrollTop', to, newState, name);\n    });\n  }\n\n  render() {\n    const s = this.state;\n    const p = this.props;\n    const { window, document, activeSlide } = s;\n\n    const children = p.children || null;\n\n    if (!window) {\n      return children;\n    }\n\n    const elements = p.slides.reduce((result, sl) => {\n      if (!sl) {\n        return result;\n      }\n\n      if (typeof sl.type !== 'function') {\n        result.other.push(sl);\n      } else {\n        result.slides.push(sl);\n      }\n\n      return result;\n    }, { slides: [], other: [] });\n\n    const { other, slides } = elements;\n\n    // TODO: sub other for children\n    return (\n        <WindowSize\n          render={({ width, height }) => {\n\n            const to = activeSlide * height;\n            setTimeout(() => {\n              this.verticalRoot.scrollTop = to;\n            }, 0);\n\n            return (\n              <div ref={node => (this.node = node)} className=\"Fullpage\">\n                {children}\n                {other.map((o, i) => {\n                  const op = o.props || {};\n                  return <div key={i} {...op} />;\n                })}\n\n                {slides.map((sl, i) => {\n                  const sp = sl.props || {};\n                  const children = sp.children;\n\n                  if (sp.slides) {\n                    const { name } = sp;\n                    return <HorizontalSlider cache={this.cacheHslide.bind(this)} width={width} height={height} window={window} document={document} activeSlide={s[name].activeSlide} hideScrollBars={p.hideScrollBars} {...sp} key={i}>\n                        {children}\n                      </HorizontalSlider>;\n                  }\n\n                  return <Slide render={true} className={sp.className || ''} id={sp.id} width={width} height={height} key={i} {...sp}>\n                      {children}\n                    </Slide>;\n                })}\n              </div>\n            );\n          }}\n        />\n    );\n  }\n}\n\nfunction swap(nodes, o, i) {\n  nodes[o || i].parentNode.insertBefore(nodes[i], nodes[o]);\n  return nodes;\n}\n\nfunction lastToFirst(nodes) {\n  swap(nodes, 0, nodes.length - 1);\n}\n\nfunction firstToLast(nodes) {\n  swap(nodes, null, nodes.length - 1);\n}\n\nfunction isEligible(idx, props, state) {\n  const { slides } = props;\n  const { activeSlide } = state;\n\n  if (state.scrollPending) {\n    return false;\n  }\n\n  if (props.infinite) {\n    return true;\n  }\n\n  if (idx > slides.length - 1 || idx < 0) {\n    return false;\n  }\n\n  if (idx == activeSlide) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction ssStub() {\n  return {\n    flush: noOp,\n    killAll: noOp,\n    listen: noOp\n  };\n}\n\nfunction determineVerticalRoot() {\n  let userAgent, platform;\n\n  const { document } = global;\n\n  if (typeof navigator !== 'undefined' && navigator) {\n    ({ userAgent, platform } = navigator);\n  }\n\n  if (!userAgent) {\n    return document.body;\n  }\n\n  // http://developer.samsung.com/technical-doc/view.do?v=T000000203\n  if (/SAMSUNG.*Build\\//.test(userAgent)) {\n    return document.body;\n  }\n\n  const browser = detectBrowser(userAgent);\n\n  if (!browser) {\n    return document.body;\n  }\n\n  // NOTE: various browsers and devTools handle this differently as the userAgent source of truth\n  // To get the root scrollable element we have to play around with OS and browser to find the right\n  // root to return. If need be we can be specific about version\n\n  const { name, version, os } = browser; // eslint-disable-line no-unused-vars\n  const [ major, minor, patch ] = version.split('.'); // eslint-disable-line no-unused-vars\n\n  const docElementSet = new Set([\n    'firefox',\n    'chrome',\n    'ios', // iPad (chrome devtools)\n    'crios', // chrome ios (chrome devtools)\n    'ie'\n  ]);\n\n  // Some platforms conflict with the devtools when it comes to supporting document.body\n  // In order to support both user-agents in chrome devtools and the native device we need to\n  // check for both browser name and device platform\n  const conflictingPlatforms = new Set([\n    'iPhone',\n    'iPad'\n  ]);\n\n  if (docElementSet.has(name) && !conflictingPlatforms.has(platform)) {\n      return document.documentElement;\n  }\n\n  // safari, chrome ios etc\n  return document.body;\n}\nexport default Fullpage;\n"]},"metadata":{},"sourceType":"module"}