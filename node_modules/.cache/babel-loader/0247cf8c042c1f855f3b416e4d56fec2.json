{"ast":null,"code":"import easingTypes from 'tween-functions';\nimport requestAnimationFrame from 'raf';\nimport EventListener from './EventDispatcher';\nimport { currentScrollTop } from './util';\nimport mapped from './Mapped'; // 设置默认数据\n\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false\n  };\n}\n\nvar ScrollScreen = {\n  init: function init(vars) {\n    var _this = this;\n\n    this.vars = defaultData(vars || {});\n    this.rafID = -1;\n    this.toHeight = -1;\n    this.num = 0; // this.currentNum = 0;\n\n    ['raf', 'cancelRequestAnimationFrame', 'onWheel', 'startScroll', 'isScroll'].forEach(function (method) {\n      _this[method] = _this[method].bind(_this);\n    });\n    EventListener.addEventListener('wheel.scrollWheel', this.onWheel); // 刚进入时滚动条位置\n\n    setTimeout(this.startScroll);\n  },\n  startScroll: function startScroll() {\n    var _this2 = this;\n\n    var _mapped = mapped.getMapped();\n\n    var _arr = _mapped.__arr;\n\n    if (!_arr.length) {\n      EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n      return;\n    }\n\n    this.scrollTop = currentScrollTop();\n\n    _arr.forEach(function (str, i) {\n      var dom = _mapped[str];\n      var domOffsetTop = dom.offsetTop;\n      var domHeight = dom.getBoundingClientRect().height;\n\n      if (_this2.scrollTop >= domOffsetTop && _this2.scrollTop < domOffsetTop + domHeight) {\n        _this2.num = i;\n        _this2.toHeight = domOffsetTop;\n      }\n    }); // 如果 toHeight === -1 且 this.scrollTop 有值时；\n\n\n    if (this.toHeight === -1) {\n      if (this.scrollTop > 0) {\n        var endDom = mapped.get(mapped.getMapped().__arr[mapped.getMapped().__arr.length - 1]);\n        var windowHeight = document.documentElement.clientHeight;\n        var tooNum = Math.ceil((this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / windowHeight);\n        this.num = mapped.getMapped().__arr.length + tooNum;\n      }\n\n      return;\n    }\n\n    if (this.toHeight !== this.scrollTop) {\n      this.initTime = Date.now();\n      this.rafID = requestAnimationFrame(this.raf);\n    } else {\n      this.toHeight = -1;\n    }\n  },\n  raf: function raf() {\n    var _this3 = this;\n\n    var duration = this.vars.duration;\n    var now = Date.now();\n    var progressTime = now - this.initTime > duration ? duration : now - this.initTime;\n    var easeValue = easingTypes[this.vars.ease](progressTime, this.scrollTop, this.toHeight, duration);\n    window.scrollTo(window.scrollX, easeValue);\n\n    if (progressTime === duration) {\n      this.cancelRequestAnimationFrame();\n      setTimeout(function () {\n        _this3.toHeight = -1;\n      }, this.vars.scrollInterval);\n    } else {\n      this.rafID = requestAnimationFrame(this.raf);\n    }\n  },\n  cancelRequestAnimationFrame: function cancelRequestAnimationFrame() {\n    requestAnimationFrame.cancel(this.rafID);\n    this.rafID = -1;\n  },\n  getComputedStyle: function getComputedStyle(dom) {\n    return document.defaultView ? document.defaultView.getComputedStyle(dom) : {};\n  },\n  isScroll: function isScroll(dom) {\n    var style = this.getComputedStyle(dom);\n    var overflow = style.overflow;\n    var overflowY = style.overflowY;\n    var isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay' || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay';\n\n    if (dom === document.body) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight && isScrollOverflow && dom.scrollTop < dom.scrollHeight) {\n      return true;\n    }\n\n    return this.isScroll(dom.parentNode);\n  },\n  onWheel: function onWheel(e) {\n    var _this4 = this;\n\n    var _mapped = mapped.getMapped();\n\n    if (!_mapped.__arr.length) {\n      EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n      return;\n    }\n\n    if (this.isScroll(e.target)) {\n      return;\n    }\n\n    var deltaY = e.deltaY;\n    e.preventDefault();\n\n    if (this.rafID === -1 && deltaY !== 0 && this.toHeight === -1) {\n      // 如果滚动条托动过了，需要获取当前的num;\n      var _arr = _mapped.__arr;\n      var endDom = mapped.get(_arr[_arr.length - 1]);\n      var startDom = mapped.get(_arr[0]);\n      var windowHeight = document.documentElement.clientHeight;\n      this.scrollTop = currentScrollTop();\n\n      _arr.forEach(function (str, i) {\n        var dom = _mapped[str];\n        var domOffsetTop = dom.offsetTop;\n        var domHeight = dom.getBoundingClientRect().height;\n\n        if (_this4.scrollTop >= domOffsetTop && _this4.scrollTop < domOffsetTop + domHeight) {\n          _this4.num = i;\n        }\n      });\n\n      var startManyHeight = startDom.offsetTop;\n      var startManyScale = startManyHeight ? Math.ceil(startManyHeight / windowHeight) : 0;\n      var tooNum;\n\n      if (this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((this.scrollTop - endDom.offsetTop - endDom.getBoundingClientRect().height) / windowHeight);\n        this.num = _arr.length + tooNum;\n      } else if (this.scrollTop < startDom.offsetTop) {\n        tooNum = Math.ceil(-(this.scrollTop - startManyHeight) / windowHeight);\n        this.num = -tooNum;\n      }\n\n      if (deltaY < 0) {\n        this.num--;\n      } else if (deltaY > 0) {\n        this.num++;\n      }\n\n      var docHeight = this.vars.docHeight || document.body.scrollHeight;\n      var manyHeight = docHeight - endDom.offsetTop - endDom.getBoundingClientRect().height;\n      var manyScale = manyHeight ? Math.ceil(manyHeight / windowHeight) : 0;\n      var maxNum = _arr.length + manyScale;\n\n      if (this.vars.loop) {\n        this.num = this.num < -startManyScale ? maxNum - 1 : this.num;\n        this.num = this.num >= maxNum ? -startManyScale : this.num;\n      } else {\n        this.num = this.num <= -startManyScale ? -startManyScale : this.num;\n        this.num = this.num >= maxNum ? maxNum : this.num;\n      }\n\n      this.initTime = Date.now();\n      var currentDom = mapped.get(mapped.getMapped().__arr[this.num]);\n      this.toHeight = currentDom ? currentDom.offsetTop : null;\n      this.toHeight = typeof this.toHeight !== 'number' ? endDom.offsetTop + endDom.getBoundingClientRect().height + windowHeight * (this.num - mapped.getMapped().__arr.length) : this.toHeight;\n      this.toHeight = this.toHeight < 0 ? 0 : this.toHeight;\n      this.toHeight = this.toHeight > docHeight - windowHeight ? docHeight - windowHeight : this.toHeight;\n      this.rafID = requestAnimationFrame(this.raf);\n      this.currentNum = this.num;\n    }\n  },\n  unMount: function unMount() {\n    EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n  }\n};\nexport default {\n  init: ScrollScreen.init.bind(ScrollScreen),\n  unMount: ScrollScreen.unMount.bind(ScrollScreen)\n};","map":{"version":3,"sources":["/Users/ale/Library/Mobile Documents/com~apple~CloudDocs/a/jobs/ws/alealmeida/src/ScrollScreen.js"],"names":["easingTypes","requestAnimationFrame","EventListener","currentScrollTop","mapped","defaultData","vars","ease","duration","docHeight","scrollInterval","loop","ScrollScreen","init","rafID","toHeight","num","forEach","method","bind","addEventListener","onWheel","setTimeout","startScroll","_mapped","getMapped","_arr","__arr","length","removeEventListener","scrollTop","str","i","dom","domOffsetTop","offsetTop","domHeight","getBoundingClientRect","height","endDom","get","windowHeight","document","documentElement","clientHeight","tooNum","Math","ceil","initTime","Date","now","raf","progressTime","easeValue","window","scrollTo","scrollX","cancelRequestAnimationFrame","cancel","getComputedStyle","defaultView","isScroll","style","overflow","overflowY","isScrollOverflow","body","scrollHeight","offsetHeight","parentNode","e","target","deltaY","preventDefault","startDom","startManyHeight","startManyScale","manyHeight","manyScale","maxNum","currentDom","currentNum","unMount"],"mappings":"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","sourcesContent":["import easingTypes from 'tween-functions';\nimport requestAnimationFrame from 'raf';\nimport EventListener from './EventDispatcher';\nimport { currentScrollTop } from './util';\nimport mapped from './Mapped';\n\n// 设置默认数据\nfunction defaultData(vars) {\n  return {\n    ease: vars.ease || 'easeInOutQuad',\n    duration: vars.duration || 450,\n    docHeight: vars.docHeight,\n    scrollInterval: vars.scrollInterval || 1000,\n    loop: vars.loop || false,\n  };\n}\n\nconst ScrollScreen = {\n  init(vars) {\n    this.vars = defaultData(vars || {});\n    this.rafID = -1;\n    this.toHeight = -1;\n    this.num = 0;\n    // this.currentNum = 0;\n    ['raf', 'cancelRequestAnimationFrame', 'onWheel', 'startScroll', 'isScroll']\n      .forEach((method) => { this[method] = this[method].bind(this); });\n    EventListener.addEventListener('wheel.scrollWheel', this.onWheel);\n    // 刚进入时滚动条位置\n    setTimeout(this.startScroll);\n  },\n\n  startScroll() {\n    const _mapped = mapped.getMapped();\n    const _arr = _mapped.__arr;\n    if (!_arr.length) {\n      EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n      return;\n    }\n    this.scrollTop = currentScrollTop();\n    _arr.forEach((str, i) => {\n      const dom = _mapped[str];\n      const domOffsetTop = dom.offsetTop;\n      const domHeight = dom.getBoundingClientRect().height;\n      if (this.scrollTop >= domOffsetTop && this.scrollTop < domOffsetTop + domHeight) {\n        this.num = i;\n        this.toHeight = domOffsetTop;\n      }\n    });\n    // 如果 toHeight === -1 且 this.scrollTop 有值时；\n    if (this.toHeight === -1) {\n      if (this.scrollTop > 0) {\n        const endDom = mapped.get(mapped.getMapped().__arr[mapped.getMapped().__arr.length - 1]);\n        const windowHeight = document.documentElement.clientHeight;\n        const tooNum = Math.ceil((this.scrollTop - endDom.offsetTop -\n          endDom.getBoundingClientRect().height) / windowHeight);\n        this.num = mapped.getMapped().__arr.length + tooNum;\n      }\n      return;\n    }\n    if (this.toHeight !== this.scrollTop) {\n      this.initTime = Date.now();\n      this.rafID = requestAnimationFrame(this.raf);\n    } else {\n      this.toHeight = -1;\n    }\n  },\n  raf() {\n    const duration = this.vars.duration;\n    const now = Date.now();\n    const progressTime = now - this.initTime > duration ? duration : now - this.initTime;\n    const easeValue = easingTypes[this.vars.ease](progressTime, this.scrollTop,\n      this.toHeight, duration);\n    window.scrollTo(window.scrollX, easeValue);\n    if (progressTime === duration) {\n      this.cancelRequestAnimationFrame();\n      setTimeout(() => {\n        this.toHeight = -1;\n      }, this.vars.scrollInterval);\n    } else {\n      this.rafID = requestAnimationFrame(this.raf);\n    }\n  },\n  cancelRequestAnimationFrame() {\n    requestAnimationFrame.cancel(this.rafID);\n    this.rafID = -1;\n  },\n  getComputedStyle(dom) {\n    return document.defaultView ? document.defaultView.getComputedStyle(dom) : {};\n  },\n  isScroll(dom) {\n    const style = this.getComputedStyle(dom);\n    const overflow = style.overflow;\n    const overflowY = style.overflowY;\n    const isScrollOverflow = overflow === 'auto' || overflow === 'scroll' || overflow === 'overlay'\n      || overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay';\n    if (dom === document.body) {\n      return false;\n    } else if (dom.scrollHeight > dom.offsetHeight\n      && isScrollOverflow\n      && dom.scrollTop < dom.scrollHeight) {\n      return true;\n    }\n    return this.isScroll(dom.parentNode);\n  },\n  onWheel(e) {\n    const _mapped = mapped.getMapped();\n    if (!_mapped.__arr.length) {\n      EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n      return;\n    }\n    if (this.isScroll(e.target)) {\n      return;\n    }\n    const deltaY = e.deltaY;\n    e.preventDefault();\n    if (this.rafID === -1 && deltaY !== 0 && this.toHeight === -1) {\n      // 如果滚动条托动过了，需要获取当前的num;\n      const _arr = _mapped.__arr;\n      const endDom = mapped.get(_arr[_arr.length - 1]);\n      const startDom = mapped.get(_arr[0]);\n      const windowHeight = document.documentElement.clientHeight;\n      this.scrollTop = currentScrollTop();\n      _arr.forEach((str, i) => {\n        const dom = _mapped[str];\n        const domOffsetTop = dom.offsetTop;\n        const domHeight = dom.getBoundingClientRect().height;\n        if (this.scrollTop >= domOffsetTop && this.scrollTop < domOffsetTop + domHeight) {\n          this.num = i;\n        }\n      });\n      const startManyHeight = startDom.offsetTop;\n      const startManyScale = startManyHeight ? Math.ceil(startManyHeight / windowHeight) : 0;\n      let tooNum;\n      if (this.scrollTop > endDom.offsetTop + endDom.getBoundingClientRect().height) {\n        tooNum = Math.ceil((this.scrollTop - endDom.offsetTop -\n          endDom.getBoundingClientRect().height) / windowHeight);\n        this.num = _arr.length + tooNum;\n      } else if (this.scrollTop < startDom.offsetTop) {\n        tooNum = Math.ceil(-(this.scrollTop - startManyHeight) / windowHeight);\n        this.num = -tooNum;\n      }\n      if (deltaY < 0) {\n        this.num--;\n      } else if (deltaY > 0) {\n        this.num++;\n      }\n      const docHeight = this.vars.docHeight || document.body.scrollHeight;\n      const manyHeight = docHeight - endDom.offsetTop -\n        endDom.getBoundingClientRect().height;\n      const manyScale = manyHeight ? Math.ceil(manyHeight / windowHeight) : 0;\n      const maxNum = _arr.length + manyScale;\n      if (this.vars.loop) {\n        this.num = this.num < -startManyScale ? maxNum - 1 : this.num;\n        this.num = this.num >= maxNum ? -startManyScale : this.num;\n      } else {\n        this.num = this.num <= -startManyScale ? -startManyScale : this.num;\n        this.num = this.num >= maxNum ? maxNum : this.num;\n      }\n      this.initTime = Date.now();\n      const currentDom = mapped.get(mapped.getMapped().__arr[this.num]);\n      this.toHeight = currentDom ? currentDom.offsetTop : null;\n      this.toHeight = typeof this.toHeight !== 'number' ?\n        endDom.offsetTop + endDom.getBoundingClientRect().height +\n        windowHeight * (this.num - mapped.getMapped().__arr.length) : this.toHeight;\n      this.toHeight = this.toHeight < 0 ? 0 : this.toHeight;\n      this.toHeight = this.toHeight > docHeight - windowHeight ?\n        (docHeight - windowHeight) : this.toHeight;\n      this.rafID = requestAnimationFrame(this.raf);\n      this.currentNum = this.num;\n    }\n  },\n  unMount() {\n    EventListener.removeEventListener('wheel.scrollWheel', this.onWheel);\n  },\n};\nexport default {\n  init: ScrollScreen.init.bind(ScrollScreen),\n  unMount: ScrollScreen.unMount.bind(ScrollScreen),\n};"]},"metadata":{},"sourceType":"module"}